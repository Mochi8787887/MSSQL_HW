SQL Lab
LAB－資料庫、資料表建立
請於測試環境(10.11.37.148)登入，登入帳號/密碼皆為(你的員工編號)
每次交功課請提供SQL檔案，並依照檔名規則命名，檔名範例： 
請先指定資料庫(USE)，並清楚標明題號標題與答案。
若繳交為SP/FUN，無須提供完整SP/FUN，僅請提供如何執行該支SP/FUN即可。



一、	建立一個新的資料庫，資料庫名稱為TrainDB120061(後6碼為你的員工編號)
二、	建立四張資料表，內容隨意建：(需建立PK與 INDEX)
(1)	部門資料表 (表格名稱：Dept)
欄位名稱	型態	中文欄位名稱
DeptNo	Varchar(10)	部門代碼
DeptName	Varchar(20)	部門名稱

(2)	員工 (表格名稱：Employee)
欄位名稱	型態	中文欄位名稱
EmpNo	Varchar(10)	員工編號
EmpName	Varchar(10)	員工姓名
Sex	Varchar(2)	員工性別
DeptNo	Varchar(10)	所屬部門代碼
Salary	Int	薪水
Birth	varchar(8)	生日

(3)	假別 (表格名稱：Absent)
欄位名稱		型態	中文欄位名稱
AbsType		Varchar(8)	假別代碼
AbsName		Varchar(10)	假別名稱

(4)	請假明細(表格名稱：AbsDetail)
Dept	型態	中文欄位名稱
EmpNo	Varchar(10)	請假員工編號
AbsType	Varchar(8)	假別代碼
AbsDate	Datetime	請假日期
AbsHour	Int	請假時數

 
LAB－範例練習
1.	計算每一部門所需的部門名稱、薪資總額、平均薪資，並照薪資總額由高到低排序
(每一部門的定義：若有部門轄下都無同仁，則薪資總額與平均薪資皆顯示為0)
2.	計算每一部門的部門名稱、總人數
3.	計算公司裡男女生的人數總人數
4.	計算每一員工的員工姓名、2021/03/15以後(含)請假的總時數(某員工03/15後沒請假需顯示0)
5.	計算每一員工的員工姓名、2017/12/15以後(含)請假的總時數，總時數超過6小時的才顯示
6.	計算每一員工每一種假別的請假總時數(某員工的某假別沒請假需顯示0)
7.	計算每一部門男女生總人數各多少(某部門沒人員請顯示無)
8.	計算公司內各月過生日的總人數
9.	將每一員工、每一種假別，在2017年以後請假總時數大於5小時的人顯示出來
10.	請寫一個STORE PROCEDURE，INPUT(@date as varchar(8),@feq as varchar(1) )—m/s/y找出上月底/上季底/上年底的日期，回傳8字元，ex:20210630
11.	請寫一個Function，取得字串中,以分隔符號區隔的資料
select dbo.fun_SplitToTable('AB,CD,EF,G',',','4') --=> G
12.	請寫一個View，至少串起來2個table資料表
13.	請寫一個STORE PROCEDURE(包含變數宣告使用，包含 CURSOR 迴圈 、IF ELSE、有SELECT(需有一筆子查詢)、INSERT & UPDATE 至少兩句、並使用Transaction,TRY CATCH …. ，交易程序
14.	寫二個Function，一個回傳值 ，另一個回傳 TABLE，並使用SELECT 使用這兩函式。
15.	思考題:時間序列(15分鐘為一單位)、檢核同一個時間僅限兩人使用，請練習設計一個TABLE並下SELECT檢核。

LAB－相關語法
1.	取得該資料表內容
SELECT 欄位名1, 欄位名2, 欄位名3
FROM 資料表名
SELECT *
FROM 資料表名

2.	依條件取得該資料表內容
SELECT 欄位名1, 欄位名2, 欄位名3
FROM 資料表名
WHERE 條件

3.	相關函數-筆數計算
SELECT COUNT(欄位名1)
FROM 資料表名
AVG (平均)
COUNT (計數)
MAX (最大值)
MIN (最小值)
SUM (總合)

4.	某欄位類別總合
SELECT 欄位名1, 欄位名2, 欄位名3
FROM 資料表名
GROUP BY 需做總合的欄位名

5.	針對某欄位做排序
SELECT 欄位名1, 欄位名2, 欄位名3
FROM 資料表名
ORDEY BY做排序之欄位名 DESC
DESC: 由高到低排序
ASC: 由低到高排序

6.	GROUP BY後，函數條件
SELECT欄位名1, SUM(欄位名2)
FROM 資料表名
GROUP BY欄位名1
HAVING 函數條件

7.	表格連結
SELECT 資料表A.欄位名1, 資料表B.欄位名1 , 資料表B.欄位名2
FROM 資料表A
INNER JOIN 資料表B
ON 資料表A.欄位名1 = 資料表B.欄位名1
 
LAB－延伸練習
1.	查詢姓陳的員工有哪些人，查詢結果要有員工編號、姓名、性別(顯示中文男/女)和目前年齡。
2.	請求出32歲的女性的員工，查詢結果要有部門中文名稱、員工編號、目前年齡、性別(顯示中文男/女)、並將結果根據薪資由大到小排列。
3.	請列出平均薪資最高的部門內所有同仁本年度請假各假別總時數，查詢結果要有部門中文名稱、員工編號、姓名、性別(顯示中文男/女)、請假假別、本年度請假總時數。
4.	請列出本年度平均總請假最低的部門同仁，查詢結果要有部門中文名稱、員工姓名、薪資，並按照員工編號由小排到大。
5.	請列出各假別於本年度所有公司同仁平均一人休假多少小時。
6.	請寫一個STORE PROCEDURE， 輸入年齡,性別(M/F/不輸入為全部性別)會回傳小於等於輸入年齡且性別的人的資料
7.	請寫一個STORE PROCEDURE， 輸入部門ID會將該部門同仁利用CURSOR、Transaction、TRY CATCH將該部門同仁全明日自動請公假一日，並且小於30歲者加薪10%。


